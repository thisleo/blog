<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"matlab.xyz","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="使用美团walle进行多渠道打包可以节省大量的时间, 但是使用中发现一个问题: 之前是使用walle打多渠道包, 然后将apk上传360进行加固; 后来发现加固之后的APP没有了渠道信息, 并且发现360加固完成后的自动重签名只有V1签名 因此需要我们自己手动重签名, 需要调整实现流程: 加固——重签名——多渠道打包">
<meta property="og:type" content="article">
<meta property="og:title" content="360加固 + 美团Walle多渠道自动化打包">
<meta property="og:url" content="http://matlab.xyz/2020/04/16/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/index.html">
<meta property="og:site_name" content="程序元之路">
<meta property="og:description" content="使用美团walle进行多渠道打包可以节省大量的时间, 但是使用中发现一个问题: 之前是使用walle打多渠道包, 然后将apk上传360进行加固; 后来发现加固之后的APP没有了渠道信息, 并且发现360加固完成后的自动重签名只有V1签名 因此需要我们自己手动重签名, 需要调整实现流程: 加固——重签名——多渠道打包">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://matlab.xyz/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093427.png">
<meta property="og:image" content="http://matlab.xyz/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310092933.png">
<meta property="og:image" content="http://matlab.xyz/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093055.png">
<meta property="og:image" content="http://matlab.xyz/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093134.png">
<meta property="article:published_time" content="2020-04-16T06:00:20.000Z">
<meta property="article:modified_time" content="2022-05-21T08:48:20.552Z">
<meta property="article:author" content="Chendy">
<meta property="article:tag" content="Walle">
<meta property="article:tag" content="360加固">
<meta property="article:tag" content="Gradle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://matlab.xyz/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093427.png">

<link rel="canonical" href="http://matlab.xyz/2020/04/16/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>360加固 + 美团Walle多渠道自动化打包 | 程序元之路</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">程序元之路</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">累积成长</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://matlab.xyz/2020/04/16/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chendy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序元之路">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          360加固 + 美团Walle多渠道自动化打包
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-16 14:00:20" itemprop="dateCreated datePublished" datetime="2020-04-16T14:00:20+08:00">2020-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-21 16:48:20" itemprop="dateModified" datetime="2022-05-21T16:48:20+08:00">2022-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>使用美团<a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">walle</a>进行多渠道打包可以节省大量的时间, 但是使用中发现一个问题:</p>
<p><em>之前是使用walle打多渠道包, 然后将apk上传360进行加固; 后来发现加固之后的APP没有了渠道信息, 并且发现360加固完成后的自动重签名只有V1签名</em></p>
<p>因此需要我们自己手动重签名, 需要调整实现流程: <strong>加固——重签名——多渠道打包</strong></p>
<a id="more"></a>

<h4 id="我们希望实现gradle脚本实现自动化加固、签名和多渠道打包"><a href="#我们希望实现gradle脚本实现自动化加固、签名和多渠道打包" class="headerlink" title="我们希望实现gradle脚本实现自动化加固、签名和多渠道打包"></a>我们希望实现gradle脚本实现自动化加固、签名和多渠道打包</h4><p><em>目前可以使用<a href="https://github.com/yangchong211/YCWalleHelper" target="_blank" rel="noopener">瓦力多渠道打包的Python脚本</a>实现自动化打包, 但是使用的<code>python2.7</code>版本</em></p>
<p>另一种思路是使用gradle脚本实现:</p>
<p><strong>在此感谢原创作者：天子卿</strong></p>
<p><strong>附作者文章链接：<a href="https://juejin.im/post/5c825ac6f265da2db9129bd0" target="_blank" rel="noopener">https://juejin.im/post/5c825ac6f265da2db9129bd0</a></strong></p>
<p>通过作者文章完成此demo, 如有侵权,请联系删除</p>
<p><img src="/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093427.png" alt="20200310093427"></p>
<blockquote>
<blockquote>
<blockquote>
<h3 id="首先是集成Walle"><a href="#首先是集成Walle" class="headerlink" title="首先是集成Walle"></a>首先是集成Walle</h3><p>这里只简单写下Gradle插件使用方式, 如有其他需求请查看主页<a href="https://github.com/Meituan-Dianping" target="_blank" rel="noopener">Meituan-Dianping</a>/<strong><a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">walle</a></strong></p>
<h4 id="配置build-gradle"><a href="#配置build-gradle" class="headerlink" title="配置build.gradle"></a>配置build.gradle</h4><p>在位于项目的根目录 <code>build.gradle</code> 文件中添加Walle Gradle插件的依赖， 如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line"> dependencies &#123;</span><br><span class="line">     classpath <span class="string">'com.meituan.android.walle:plugin:1.1.6'</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>并在当前App的 <code>build.gradle</code> 文件中apply这个插件，并添加上用于读取渠道号的AAR</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'walle'</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line"> compile <span class="string">'com.meituan.android.walle:library:1.1.6'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置插件"><a href="#配置插件" class="headerlink" title="配置插件"></a>配置插件</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">walle &#123;</span><br><span class="line"> <span class="comment">// 指定渠道包的输出路径</span></span><br><span class="line"> apkOutputFolder = <span class="keyword">new</span> File(<span class="string">"$&#123;project.buildDir&#125;/outputs/channels"</span>);</span><br><span class="line"> <span class="comment">// 定制渠道包的APK的文件名称</span></span><br><span class="line"> apkFileNameFormat = <span class="string">'$&#123;appName&#125;-$&#123;packageName&#125;-$&#123;channel&#125;-$&#123;buildType&#125;-v$&#123;versionName&#125;-$&#123;versionCode&#125;-$&#123;buildTime&#125;.apk'</span>;</span><br><span class="line"> <span class="comment">// 渠道配置文件</span></span><br><span class="line"> channelFile = <span class="keyword">new</span> File(<span class="string">"$&#123;project.getProjectDir()&#125;/channel"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="如何获取渠道信息"><a href="#如何获取渠道信息" class="headerlink" title="如何获取渠道信息"></a>如何获取渠道信息</h4><p>在需要渠道等信息时可以通过下面代码进行获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String channel = WalleChannelReader.getChannel(<span class="keyword">this</span>.getApplicationContext());</span><br></pre></td></tr></table></figure>


</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><h5 id="1-加固"><a href="#1-加固" class="headerlink" title="1. 加固"></a>1. 加固</h5><p>​    加固过程： 浏览了360加固官网，整个加固过程其实很简单，主要有以下的三个步骤：</p>
<ol>
<li><p>输入360加固平台的帐号、密码</p>
</li>
<li><p>将签名文件上传到加固平台</p>
</li>
<li><p>上传需要加固的apk文件进行加固</p>
<p>关键加固命令行代码如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 360加固</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> apk 加固的原始apk File</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputPath 输出目录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> reinforceApk(File apk,outputPath) &#123;</span><br><span class="line">    println <span class="string">"--- 360 reinforceApk start! ---"</span></span><br><span class="line">    println <span class="string">"reinforce apk:"</span> + apk</span><br><span class="line">    <span class="keyword">if</span>(apk == <span class="literal">null</span> || !apk.exists()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">'apk is not exists and cannot reinforce'</span>)</span><br><span class="line">        println <span class="string">"---360 reinforceApk throw exception and forced stop!---"</span></span><br><span class="line">    &#125;</span><br><span class="line">    exec &#123;</span><br><span class="line">        commandLine <span class="string">"&#123;命令执行符号&#125;"</span>, <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -login  $&#123;REINFORCE_NAME&#125; $&#123;REINFORCE_PASSWORD&#125;"</span></span><br><span class="line">        commandLine <span class="string">"&#123;命令执行符号&#125;"</span>, <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -showsign"</span></span><br><span class="line">        commandLine <span class="string">"&#123;命令执行符号&#125;"</span>, <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -jiagu $&#123;apk&#125; $&#123;outputPath&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    println <span class="string">"--- 360 reinforce end! ---"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明:</strong> 系统环境不同，<code>{命令执行符号}</code>也会不同（Linux系统：sh ；Mac系统：bash ；windows系统：powershell）;</p>
</li>
</ol>
<h5 id="2-重签名"><a href="#2-重签名" class="headerlink" title="2. 重签名"></a>2. 重签名</h5><p>​    加固完成后,对加固apk进行重签名;</p>
<p>​    使用AndroidSDK中的build-tools目录下, 使用压缩对齐工具和签名工具完成重签名, 步骤如下:</p>
<ol>
<li><p>对齐，对Apk文件进行存档对齐优化，确保所有的未压缩数据都从文件的开始位置以指定的对齐方式排列</p>
</li>
<li><p>签名，选择Signature V2   </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commandLine <span class="string">"&#123;命令执行符号&#125;"</span>,<span class="string">"-c"</span>, <span class="string">"&#123;zipalign工具的文件路径&#125; -v -p 4  &#123;已加固的apk文件路径&#125; &#123;对齐后输出的apk文件路径&#125;"</span></span><br><span class="line">commandLine <span class="string">"&#123;命令执行符号&#125;"</span>, <span class="string">"-c"</span>, <span class="string">"&#123;apksigner工具的文件路径&#125; sign --ks &#123;签名文件的位置&#125; --ks-key-alias &#123;alias别名&#125; --ks-pass pass:&#123;签名文件存储的密码&#125; --key-pass pass:&#123;alias密码&#125; --out &#123;签名后输出的apk文件&#125; &#123;对齐后输出的apk文件路径&#125;"</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h5 id="3-多渠道打包"><a href="#3-多渠道打包" class="headerlink" title="3. 多渠道打包"></a>3. 多渠道打包</h5><p>​    签名完成后, 使用walle进行多渠道打包</p>
<p>​    平时使用walle多渠道打包，只需要在app/build.gradle下配置插件，指定渠道包的输出路径和渠道配置文件即    可，最后在Android studio的Terminal中输入./gradlew assembleReleaseChannels，任务执行完成后在指定的    输出路径下生成多个对应的渠道包。具体的流程和细节可参考<a href="https://github.com/Meituan-Dianping/walle" target="_blank" rel="noopener">官方介绍</a>。</p>
<p>​    这种多渠道打包方式是全自动化构建，很难去干涉到构建流程，不符合我们的需求   </p>
<ol>
<li><p>在app/build.gradle配置插件时，在官方介绍中并没有找到指定源APK输入路径的方式，估计打包插件默认使用的是app/build/outputs/apk/release下的apk文件，这样就没办法对不同文件路径下的已加固apk包进行多渠道打包。</p>
</li>
<li><p>打包任务设置在assembleRelease之后执行，这个执行依赖封装在插件内部，外部很难修改打包任务依赖于加固任务，在加固任务之后执行。     </p>
</li>
</ol>
<p>   除了上面的多渠道打包方式之后，walle还提供了另外一种多渠道打包方式，用命令行执行walle提供的walle-cli-all.jar执行打包操作，只需要一条打包命令即可完成打包。   </p>
   <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commandLine <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"java -jar &#123;walle-cli-all.jar文件路径&#125; batch -f &#123;渠道文件路径&#125; &#123;要加渠道的apk文件路径&#125; &#123;渠道包的输出路径&#125;"</span></span><br></pre></td></tr></table></figure>

<p>   walle-cli-all.jar文件下载地址：<a href="https://github.com/Meituan-Dianping/walle/tree/master/walle-cli" target="_blank" rel="noopener">官方:walle-cli-all.jar</a>, <a href="https://github.com/vclub/vclub.github.io/raw/master/walle-cli-all.jar" target="_blank" rel="noopener">其他开发提供的编译版本</a></p>
<p>   这里为什么会有两个版本呢! 因为发现了一个比较坑的地方官方的版本打完包会发现在系统9.0（P）下无法正常安装, 相关问题可以查看<a href="https://github.com/Meituan-Dianping/walle/issues/264" target="_blank" rel="noopener">Issue</a>, 当然你也可以自己拉取源码编译</p>
<hr>
<h3 id="整体流程"><a href="#整体流程" class="headerlink" title="整体流程"></a>整体流程</h3><p>首先，将加固和打包操作封装成自动化操作，利用gradle脚本构建加固任务。</p>
<p>为了代码解耦，我们不在app/build.gradle里面实现加固任务，而是重新建一个gradle文件來实现具体的加固和多渠道打包过程，在app/build.gradle只需要通过<code>apply from: &#39;×××.gradle&#39;</code>引用这个gradle文件即可，</p>
<p><img src="/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310092933.png" alt="20200310092933"></p>
<p>当需要修改加固的一些代码逻辑时，只需要在这个gradle文件里面修改。</p>
<p>引入工具包。根据自己的系统环境，在<a href="http://jiagu.360.cn/#/global/download" target="_blank" rel="noopener">加固助手网页</a>选择对应的加固助手工具，下载后将里面的jiagu文件夹拷贝到自己项目的根目录下;</p>
<p>在<a href="https://github.com/Meituan-Dianping/walle/tree/master/walle-cli" target="_blank" rel="noopener">walle-cli-jar下载链接</a>下载jar包到自己项目中。</p>
<p><img src="/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093055.png" alt="20200310093055"></p>
<p>确定加固任务的时机。加固任务时机应该在release包生成之后，那么加固任务应该依赖于assembleRelease这个任务，并且设置在这个任务之后执行。</p>
<p>接下来就是我们的基本流程了</p>
<pre><code>1. 找到release包, 一般在`app/build/outputs/apk/release/`路径下
   2. 执行加固命令，将release包路径设置到命令中，并指定加固apk文件的输出路径
      3. 找到已加固的apk文件，对已加固apk文件进行对齐、重签名。（360已加固的apk文件会在原有的release文件名后面加上&quot;_jiagu&quot;）
         4. 找到重新签名的apk文件，执行多渠道打包命令。（重签名后的文件名是在原有文件名后面加上&quot;_sign&quot;）</code></pre><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">task assembleReinforceRelease() &#123;</span><br><span class="line">    group <span class="string">'360reinforce'</span></span><br><span class="line">    dependsOn(<span class="string">"assembleRelease"</span>)</span><br><span class="line"></span><br><span class="line">    doLast &#123;</span><br><span class="line">        cleanFilesPath(CHANNEL_APKS_PATH)   <span class="comment">//清空上一次生成的渠道包</span></span><br><span class="line">        <span class="keyword">def</span> releaseApkFile = findApkFile(DEFAULT_APK_PATH, <span class="string">"-release"</span>)  <span class="comment">//遍历文件，寻找release包</span></span><br><span class="line">        println <span class="string">"--release--1-"</span> + releaseApkFile</span><br><span class="line">        <span class="keyword">if</span> (releaseApkFile != <span class="literal">null</span>) &#123;</span><br><span class="line">            reinforceApk(releaseApkFile, SOURCE_APK_PATH)   <span class="comment">//执行加固</span></span><br><span class="line">            <span class="keyword">def</span> reinforceApk = findApkFile(SOURCE_APK_PATH, <span class="string">"_jiagu"</span>)  <span class="comment">//寻找已加固的apk包</span></span><br><span class="line">            println <span class="string">"--jiagu--2-"</span> + reinforceApk</span><br><span class="line">            <span class="keyword">if</span>(reinforceApk != <span class="literal">null</span>) &#123;</span><br><span class="line">                zipAlignApk(reinforceApk) <span class="comment">// zip对齐</span></span><br><span class="line">                <span class="keyword">def</span> zipAlignApk = findApkFile(SOURCE_APK_PATH, <span class="string">"_zip"</span>)</span><br><span class="line">                <span class="keyword">if</span> (zipAlignApk != <span class="literal">null</span>) &#123;</span><br><span class="line">                    signApkV2(zipAlignApk)  <span class="comment">//使用V2重签名</span></span><br><span class="line">                    <span class="keyword">def</span> signatureApk = findApkFile(SOURCE_APK_PATH, <span class="string">"_sign"</span>)</span><br><span class="line">                    println <span class="string">"--sign--3-"</span> + signatureApk</span><br><span class="line">                    <span class="keyword">if</span>(signatureApk != <span class="literal">null</span>) &#123;</span><br><span class="line">                        buildChannelApks(signatureApk)  <span class="comment">//执行多渠道打包</span></span><br><span class="line">                        renameChannelApkFiles(CHANNEL_APKS_PATH) <span class="comment">//重命名渠道包</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码优化:</p>
<ol>
<li>流程中涉及360加固平台帐号密码等敏感信息，可以将这部分信息放到签名信息所在的文件（eg：keystore.properties）中统一管理，然后将这些信息加载到gradle文件中；</li>
<li>各种输入输出的文件路径定义为常量，便于修改和管理；</li>
</ol>
<p>加固方法:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 360加固</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> apk 加固的原始apk File</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputPath 输出目录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> reinforceApk(File apk, outputPath) &#123;</span><br><span class="line">    println <span class="string">"--- 360 reinforceApk start! ---"</span></span><br><span class="line">    println <span class="string">"reinforce apk:"</span> + apk</span><br><span class="line">    <span class="keyword">if</span> (apk == <span class="literal">null</span> || !apk.exists()) &#123;</span><br><span class="line">        println <span class="string">"---360 reinforceApk throw exception and forced stop!---"</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">'apk is not exists and cannot reinforce'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">def</span> file = <span class="keyword">new</span> File(outputPath)</span><br><span class="line">    <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">        file.mkdir()</span><br><span class="line">    &#125;</span><br><span class="line">    exec &#123;</span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -login  $&#123;REINFORCE_NAME&#125; $&#123;REINFORCE_PASSWORD&#125;"</span></span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -showsign"</span></span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;REINFORCE_JAR&#125; -jiagu $&#123;apk&#125; $&#123;outputPath&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    println <span class="string">"--- 360 reinforce end! ---"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>压缩对齐方法:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加固后的apk 对齐压缩</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> apk 已加固apk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回对齐压缩后的apk</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> zipAlignApk(File apk) &#123;</span><br><span class="line">    <span class="keyword">if</span> (apk == <span class="literal">null</span> || !apk.exists()) &#123;</span><br><span class="line">        println <span class="string">"---zipalign reinforceApk throw exception and forced stop!---"</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">'apk is not exists and cannot reinforce'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">def</span> BUILD_TOOL_PATH = getAndroidSdkPath()</span><br><span class="line">    <span class="keyword">def</span> APK_NAME = getApkName() + <span class="string">"_jiagu_zip.apk"</span></span><br><span class="line">    <span class="keyword">def</span> file = <span class="keyword">new</span> File(<span class="string">"$&#123;SOURCE_APK_PATH&#125;/$&#123;APK_NAME&#125;"</span>)</span><br><span class="line">    <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">        file.delete()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    exec &#123;</span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"$&#123;BUILD_TOOL_PATH&#125;zipalign -v -p 4 $&#123;apk&#125; $&#123;SOURCE_APK_PATH&#125;/$&#123;APK_NAME&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>签名方法:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对apk签名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> zipApk 压缩对齐后的apk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 签名后的apk</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> signApkV2(File zipApk) &#123;</span><br><span class="line">    <span class="keyword">if</span> (zipApk == <span class="literal">null</span> || !zipApk.exists()) &#123;</span><br><span class="line">        println <span class="string">"---sign zipApk throw exception and forced stop!---"</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">'apk is not exists and cannot reinforce'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">def</span> BUILD_TOOL_PATH = getAndroidSdkPath()</span><br><span class="line">    <span class="keyword">def</span> APK_NAME = <span class="string">"app-release_"</span> + getApkVersionName() + <span class="string">"_jiagu_zip_sign.apk"</span></span><br><span class="line">    <span class="keyword">def</span> file = <span class="keyword">new</span> File(<span class="string">"$&#123;SOURCE_APK_PATH&#125;/$&#123;APK_NAME&#125;"</span>)</span><br><span class="line">    <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">        file.delete()</span><br><span class="line">    &#125;</span><br><span class="line">    exec &#123;</span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"$&#123;BUILD_TOOL_PATH&#125;apksigner sign --ks $&#123;KEY_PATH&#125; --ks-key-alias $&#123;ALIAS&#125; --ks-pass pass:$&#123;KEY_PASSWORD&#125; --key-pass pass:$&#123;ALIAS_PASSWORD&#125; --out $&#123;SOURCE_APK_PATH&#125;/$&#123;APK_NAME&#125; $&#123;zipApk&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加渠道信息:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对签名后的apk添加渠道信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> apk 已签名apk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 添加渠道信息后的apk</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> buildChannelApks(File apk) &#123;</span><br><span class="line">    <span class="keyword">if</span> (apk == <span class="literal">null</span> || !apk.exists()) &#123;</span><br><span class="line">        println <span class="string">"---Channel build Apk throw exception and forced stop!---"</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">'apk is not exists and cannot reinforce'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">def</span> file = <span class="keyword">new</span> File(CHANNEL_APKS_PATH)</span><br><span class="line">    <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">        file.mkdir()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">def</span> APK_NAME = getApkName() + <span class="string">"_jiagu_zip_sign.apk"</span></span><br><span class="line"></span><br><span class="line">    exec &#123;</span><br><span class="line">        <span class="comment">//java -jar walle-cli-all.jar batch -f /Users/Meituan/walle/app/channel  /Users/Meituan/walle/app/build/outputs/apk/app.apk</span></span><br><span class="line">        commandLine getCommand(), <span class="string">"-c"</span>, <span class="string">"java -jar $&#123;WALLE_JAR&#125; batch -f $&#123;WALLE_CHANNELS_CONFIG&#125; $&#123;SOURCE_APK_PATH&#125;/$&#123;APK_NAME&#125; $&#123;CHANNEL_APKS_PATH&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重命名apk:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重命名apk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> path 渠道apk目录路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">def</span> renameChannelApkFiles(path) &#123;</span><br><span class="line"><span class="comment">//    def APK_NAME = "app-release_" + getApkVersionName() + "_jiagu_zip_sign.apk"</span></span><br><span class="line">    <span class="keyword">def</span> regex = getApkName() + <span class="string">"_jiagu_zip_sign"</span></span><br><span class="line">    <span class="keyword">def</span> dir = <span class="keyword">new</span> File(path+<span class="string">"/"</span>)</span><br><span class="line">    dir.listFiles().each &#123;file -&gt;</span><br><span class="line">        <span class="keyword">if</span> (file.name =~ <span class="regexp">/$&#123;regex&#125;.*\.apk/</span>) &#123;</span><br><span class="line">            String newName = file.name</span><br><span class="line">            newName = newName.replaceAll(<span class="regexp">~/_jiagu/</span>, <span class="string">""</span>)</span><br><span class="line">            newName = newName.replaceAll(<span class="regexp">~/_zip/</span>, <span class="string">""</span>)</span><br><span class="line">            newName = newName.replaceAll(<span class="regexp">~/_sign/</span>, <span class="string">""</span>)</span><br><span class="line">            file.renameTo(<span class="keyword">new</span> File(file.getParent(), newName))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>涉及到的各种常量，各种密钥名、路径都要根据自己的实际情况修改：</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*加载keystore.properties信息到该gradle文件中*/</span></span><br><span class="line"><span class="keyword">def</span> keystorePropertiesFile = rootProject.file(<span class="string">"keystore.properties"</span>)</span><br><span class="line"><span class="keyword">def</span> keystoreProperties = <span class="keyword">new</span> Properties()</span><br><span class="line">keystoreProperties.load(<span class="keyword">new</span> FileInputStream(keystorePropertiesFile))</span><br><span class="line"></span><br><span class="line">ext &#123;</span><br><span class="line">    <span class="comment">/*加固*/</span></span><br><span class="line">    REINFORCE_JAR = <span class="string">"$&#123;project.rootDir&#125;/jiagu/jiagu.jar"</span></span><br><span class="line">    REINFORCE_NAME = keystoreProperties[<span class="string">'360_NAME'</span>] <span class="comment">//360加固账号</span></span><br><span class="line">    REINFORCE_PASSWORD = keystoreProperties[<span class="string">'360_PASSWORD'</span>] <span class="comment">//360加固密码</span></span><br><span class="line">    KEY_PATH = keystoreProperties[<span class="string">'storeFile'</span>] <span class="comment">//密钥路径</span></span><br><span class="line">    KEY_PASSWORD = keystoreProperties[<span class="string">'storePassword'</span>] <span class="comment">//密钥密码</span></span><br><span class="line">    ALIAS = keystoreProperties[<span class="string">'keyAlias'</span>] <span class="comment">//密钥别名</span></span><br><span class="line">    ALIAS_PASSWORD = keystoreProperties[<span class="string">'keyPassword'</span>] <span class="comment">//别名密码</span></span><br><span class="line">    SOURCE_APK_PATH = <span class="string">"$&#123;project.buildDir&#125;/bakApk"</span>  <span class="comment">//源apk文件路径</span></span><br><span class="line">    DEFAULT_APK_PATH = <span class="string">"$&#123;project.buildDir&#125;/outputs/apk/release"</span> <span class="comment">//默认release文件路径</span></span><br><span class="line">    <span class="comment">/*多渠道打包*/</span></span><br><span class="line">    WALLE_JAR = <span class="string">"$&#123;project.rootDir&#125;/walle-cli-all.jar"</span></span><br><span class="line">    WALLE_CHANNELS_CONFIG = <span class="string">"$&#123;project.rootDir&#125;/app/channel"</span>  <span class="comment">//渠道配置文件</span></span><br><span class="line">    CHANNEL_APKS_PATH = <span class="string">"$&#123;project.buildDir&#125;/outputs/channels"</span>  <span class="comment">//渠道Apk输出路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/360%E5%8A%A0%E5%9B%BA-%E7%BE%8E%E5%9B%A2Walle%E5%A4%9A%E6%B8%A0%E9%81%93%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/20200310093134.png" alt="20200310093134"></p>
<p><a href="https://github.com/thisleo/reinforce_walle" target="_blank" rel="noopener">github地址</a></p>
<p><strong>再次感谢原创作者：天子卿</strong></p>
<p><strong>附作者文章链接：<a href="https://juejin.im/post/5c825ac6f265da2db9129bd0" target="_blank" rel="noopener">https://juejin.im/post/5c825ac6f265da2db9129bd0</a></strong></p>
<p><strong>在作者的启发下完成此demo, 如果对你有帮助请不要吝啬star</strong></p>

    </div>

    
    
    
      


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Walle/" rel="tag"># Walle</a>
              <a href="/tags/360%E5%8A%A0%E5%9B%BA/" rel="tag"># 360加固</a>
              <a href="/tags/Gradle/" rel="tag"># Gradle</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/16/RecyclerView%E4%B8%AD%E7%9A%84EditText%E8%A2%AB%E8%BD%AF%E9%94%AE%E7%9B%98%E9%81%AE%E6%8C%A1%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" rel="prev" title="RecyclerView中的EditText被软键盘遮挡的解决办法">
      <i class="fa fa-chevron-left"></i> RecyclerView中的EditText被软键盘遮挡的解决办法
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/22/Hexo%E4%BD%BF%E7%94%A8Fancybox%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="next" title="Hexo使用Fancybox问题记录">
      Hexo使用Fancybox问题记录 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
  <div class="comments">
    <script src="https://utteranc.es/client.js"
        repo="thisleo/utterances"
        issue-term="title"
        label="utterances"
        theme="github-light"
        crossorigin="anonymous"
        async>
    </script>
  </div>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#我们希望实现gradle脚本实现自动化加固、签名和多渠道打包"><span class="nav-number">1.</span> <span class="nav-text">我们希望实现gradle脚本实现自动化加固、签名和多渠道打包</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#首先是集成Walle"><span class="nav-number"></span> <span class="nav-text">首先是集成Walle</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置build-gradle"><span class="nav-number">1.</span> <span class="nav-text">配置build.gradle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置插件"><span class="nav-number">2.</span> <span class="nav-text">配置插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何获取渠道信息"><span class="nav-number">3.</span> <span class="nav-text">如何获取渠道信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现原理"><span class="nav-number"></span> <span class="nav-text">实现原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-加固"><span class="nav-number">0.1.</span> <span class="nav-text">1. 加固</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-重签名"><span class="nav-number">0.2.</span> <span class="nav-text">2. 重签名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-多渠道打包"><span class="nav-number">0.3.</span> <span class="nav-text">3. 多渠道打包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整体流程"><span class="nav-number"></span> <span class="nav-text">整体流程</span></a></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chendy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chendy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













 
  

  

   
<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>

</body>
</html>
